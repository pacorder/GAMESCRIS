<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Globo DiafragmÃ¡tico ðŸŽˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Comic Sans MS';background:#87CEEB;color:#fff;height:100vh;display:flex;flex-direction:column;overflow:hidden}
    header{background:#ff4500aa;padding:15px;text-align:center;font-size:1.8rem}
    #game{position:relative;flex:1}
    #globo{position:absolute;bottom:10%;left:50%;transform:translateX(-50%);font-size:120px;filter:drop-shadow(0 0 20px #ff0);transition:0.3s}
    #score,#timer{position:fixed;top:15px;color:#ff0;font-size:3rem;z-index:10;padding:5px 15px;background:#0008;border-radius:15px}
    #score{left:15px}#timer{right:15px}
    #msg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:5rem;display:none;z-index:20}
    button{background:#ff0;color:#000;padding:15px 40px;border:none;border-radius:50px;font-size:2rem;margin:20px;cursor:pointer;box-shadow:0 8px #0004}
    button:active{transform:scale(1.1)}
  </style>
</head>
<body>
  <header>Â¡SOPLA POR LA NARIZ Y VUELA! ðŸŽˆ</header>
  <div id="score">0</div>
  <div id="timer">30s</div>
  <div id="msg">Â¡BOCA CERRADA!</div>
  <div id="game">
    <div id="globo">ðŸŽˆ</div>
  </div>
  <button id="start">Â¡INFLAR GIGANTE!</button>

  <audio id="pop" src="https://cdn.glitch.global/d9b8c0f3-4e96-4e5f-9c12-9f2d9f2c6e89/pop.mp3"></audio>
  <audio id="win" src="https://cdn.glitch.global/d9b8c0f3-4e96-4e5f-9c12-9f2d9f2c6e89/win.mp3"></audio>

  <script>
    const globo = document.getElementById('globo');
    const msg = document.getElementById('msg');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const startBtn = document.getElementById('start');
    const pop = document.getElementById('pop');
    const win = document.getElementById('win');
    let score = 0, time = 30, stream, analyser, dataArray, ticking;

    startBtn.onclick = async () => {
      startBtn.remove();
      document.body.style.background = '#87CEEB';
      stream = await navigator.mediaDevices.getUserMedia({audio:true, video:false});
      const audioCtx = new AudioContext();
      analyser = audioCtx.createAnalyser();
      const source = audioCtx.createMediaStreamSource(stream);
      source.connect(analyser);
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);

      ticking = setInterval(gameLoop, 50);
      setInterval(() => {
        time--; timerEl.textContent = time+'s';
        if(time<=0) endGame();
      }, 1000);
    };

    function gameLoop() {
      analyser.getByteFrequencyData(dataArray);
      const nasal = dataArray.slice(20,40).reduce((a,b)=>a+b)/20; // 500-1000 Hz = soplo nasal
      const mouth = dataArray[5]; // 100 Hz = soplo bucal

      if (mouth > 100) { // Â¡ABRIÃ“ LA BOCA!
        pop.play();
        msg.textContent = "ðŸ’¥";
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 800);
        globo.style.transform = 'translateX(-50%) scale(0.5)';
        setTimeout(() => globo.style.transform = 'translateX(-50%) scale(1)', 300);
      } 
      else if (nasal > 80) { // soplÃ³ por nariz
        score += 3;
        scoreEl.textContent = score;
        globo.style.bottom = Math.min(85, 10 + score/5) + '%';
        globo.textContent = score > 200 ? 'ðŸª‚' : 'ðŸŽˆ';
      }
    }

    function endGame() {
      clearInterval(ticking);
      stream.getTracks().forEach(t=>t.stop());
      win.play();
      const premio = score >= 180 ? 'Â¡HELADO + 20 min TABLET!' : 'Â¡Casi! Juega otra vez';
      alert(`ðŸŽ‰ RÃ‰CORD: ${score} puntos\n${premio}`);
      location.reload();
    }
  </script>
</body>
</html>